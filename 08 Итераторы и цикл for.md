Итераторы и цикл `for`
======================

Итераторы и итерируемые объекты
-------------------------------

**Итератор** — объект, используемый для перебора каких-либо значений.
Основные операции над итератором: получение текущего элемента, переход
к следующему, проверка на достижение конца.

**Итератор в Python** — объект, к которому можно применить встроенную
функцию `next(it)`. Функция `next(it)` одновременно получает текущий
элемент и сдвигает итератор к следующему. При достижении конца перебираемых
значений выбрасывается исключение (ошибка) `StopIteration`:

    >>> xs = [1, 2, 3]
    >>> it = iter(xs)
    >>> next(it)
    1
    >>> next(it)
    2
    >>> next(it)
    3
    >>> next(it)
    ‹сообщение об ошибке StopIteration>

Итераторы могут перебирать элементы какой-то коллекции, либо вообще порождать
значения на лету (списковые включения, функции `map` и `zip`,
функции-генераторы с оператором `yield` и т.д.) Можно создать даже бесконечные
итераторы, вызов `next(it)` для которых никогда не выбрасывает ошибку.

**Итерируемый объект** — объект в Python, для которого можно получить итератор
при помощи встроенной функции `iter(obj)`. Итерируемыми объектами являются,
в частности, встроенные составные типы данных: списки, кортежи, строки,
словари, множества.

Для списков, кортежей, строк и множеств полученный итератор будет перебирать
элементы контейнера. Для _словарей_ итератор будет перебирать _только ключи._

Тажке для перебора содержимого словаря можно вызывать методы

* `.keys()` — итерируемый объект, итератор которого перебирает ключи,
* `.values()` — итерируемый объект, итератор которого перебирает значения,
* `.items()` — итерируемый объект, итератор которого перебирает пары
  (кортежи) `(‹ключ›, ‹значение›)`.

Конструкторы контейнеров `list(it)`, `tuple(it)`, `set(it)` могут получать
и итерируемые объекты, и итераторы — в результате будут строиться,
соответственно, списки, кортежи и множества из соответствующих значений.

Конструктор словаря `dict(it)` может принимать итерируемый объект или
итератор, перебирающий пары (кортежи), нулевой элемент которых будет
трактоваться как ключ, первый — как значение.

Напрямую работать с итераторами не очень удобно, поэтому в Python
предусмотрен специальный синтаксис для перебора итераторов. Этот синтаксис
называется «цикл `for`».

Цикл `for`
----------
Цикл `for` предназначен для перебора содержимого итераторов и итерируемых
объектов. Синтаксис:

    # простой вариант
    for ‹перем› in ‹источник›:
        ‹тело цикла›

    # с веткой else
    for ‹перем› in ‹источник›:
        ‹тело цикла›
    else:
        ‹ветка else›

Смысл следующий:

* `‹источник›` — это выражение, значением которого может быть либо итератор,
  либо итерируемый объект. Содержимое источника будет перебираться в цикле.
* `‹перем›` — переменная, куда будет помещаться очередной элемент,
  извлечённый из итератора. Если переменных указано несколько,
  то подразумевается распаковка.
* `‹тело цикла›` — блок кода, который выполняется для каждого извлечённого
  элемента.
* `‹ветка else›` — блок кода, который выполняется после перебора всех
  элементов. Если цикл был прерван при помощи оператора `break`,
  то `‹ветка else›` не выполняется.

На самом деле, ветка `else` может быть и у цикла `while`:

    while ‹условие›:
        ‹тело цикла›
    else:
        ‹ветка else›

и смысл у неё тот же самый, но для цикла `while` она используется гораздо
реже.

Последовательности. Последовательность `range`
----------------------------------------------
Последовательность — составной объект, элементы которого пронумерованы
последовательными целыми числами. Среди изученных объектов
последовательностями являются списки, кортежи и строки. К элементам
всех этих составных объектов можно обращаться при помощи операции
индексации `xs[i]`.

В Python есть особая последовательность, представляющая собой элементы
арифметической прогрессии — `range`. Её конструктор может быть вызван
тремя способами:

    range(‹предел›)
    range(‹старт›, ‹предел›)
    range(‹старт›, ‹предел›, ‹шаг›)

* `‹предел›` — предельное значение, элементы последовательности всегда
  меньше предела,
* `‹старт›` — начальное значение, если отстутствует, то подразумевается
  равным `0`,
* `‹шаг›` — разность между двумя соседними элементами, если отсутствует,
  то подразумевается равной `1`.

Параметры конструктора могут быть только целыми числами.

`range` является итерируемым объектом, поэтому её можно преобразовать,
например, в список.

Примеры:

    >>> range(10)
    range(10)
    >>> list(range(10))
    [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
    >>> list(range(2, 10))
    [2, 3, 4, 5, 6, 7, 8, 9]
    >>> list(range(2, 10, 2))
    [2, 4, 6, 8]
    >>> list(range(1, 10, 2))
    [1, 3, 5, 7, 9]

Последовательность `range` не хранит элементы явно, а порождает их налету
при необходимости.

Последовательность `range` часто используется в сочетании с циклом `for`.








