Алгоритмы сортировки
====================

Сортировка пузырьком
--------------------

Кратко алгоритм можно описать следующим образом:

* Многократно пробегаем по массиву. Если видим пару соседних элементов, таких
  что больший предшествует меньшему, меняем их местами.
* Повторяем проходы по массиву до тех пор, пока массив не отсортируется.

Допустим, у нас есть следующий список:

    [1, 2, 1, 5, 10, 12]

Первый проход:

    [1, 2, 1, 5, 10, 12]
     ↑  ↑

Первая пара отсортирована, ничего с ними не делаем, сдвигаемся:

    [1, 2, 1, 5, 10, 12]
        ↑  ↑

Здесь уже больший (`2`) предшествует меньшему (`1`), их нужно обменять местами:

    [1, 1, 2, 5, 10, 12]
        ↑  ↑

Сдвигаемся на следующую пару:

    [1, 1, 2, 5, 10, 12]
           ↑  ↑

Ничего не делаем, т.к. меньший (`2`) предшествует большему (`5`), сдвигаемся:

    [1, 1, 2, 5, 10, 12]
              ↑  ↑
    [1, 1, 2, 5, 10, 12]
                 ↑   ↑

Первый проход закончен. Получился отсортированный список.

Пример получился неинтересным, рассмотрим какой-нибудь другой пример:

Первый проход:

    [9, 3, 5, 8, 6, 7, 4, 1, 0, 2]
     ↑  ↑
    [3, 9, 5, 8, 6, 7, 4, 1, 0, 2]
        ↑  ↑
    [3, 5, 9, 8, 6, 7, 4, 1, 0, 2]
           ↑  ↑
    [3, 5, 8, 9, 6, 7, 4, 1, 0, 2]
              ↑  ↑
    [3, 5, 8, 6, 9, 7, 4, 1, 0, 2]
                 ↑  ↑
    [3, 5, 8, 6, 7, 9, 4, 1, 0, 2]
                    ↑  ↑
    [3, 5, 8, 6, 7, 4, 9, 1, 0, 2]
                       ↑  ↑
    [3, 5, 8, 6, 7, 4, 1, 9, 0, 2]
                          ↑  ↑
    [3, 5, 8, 6, 7, 4, 1, 0, 9, 2]
                             ↑  ↑
    [3, 5, 8, 6, 7, 4, 1, 0, 2, 9]
                             ↑  ↑

За первый проход элемент `9` занял своё «законное» место. Второй проход:

    [3, 5, 8, 6, 7, 4, 1, 0, 2, 9]
     ↑  ↑
    [3, 5, 8, 6, 7, 4, 1, 0, 2, 9]
        ↑  ↑
    [3, 5, 8, 6, 7, 4, 1, 0, 2, 9]
           ↑  ↑
    [3, 5, 6, 8, 7, 4, 1, 0, 2, 9]
              ↑  ↑
    [3, 5, 6, 7, 8, 4, 1, 0, 2, 9]
                 ↑  ↑
    [3, 5, 6, 7, 4, 8, 1, 0, 2, 9]
                    ↑  ↑
    [3, 5, 6, 7, 4, 1, 8, 0, 2, 9]
                       ↑  ↑
    [3, 5, 6, 7, 4, 1, 0, 8, 2, 9]
                          ↑  ↑
    [3, 5, 6, 7, 4, 1, 0, 2, 8, 9]
                             ↑  ↑

За второй проход предпоследний элемент занял правильное место. Третий проход:

    [3, 5, 6, 7, 4, 1, 0, 2, 8, 9]
     ↑  ↑
    [3, 5, 6, 7, 4, 1, 0, 2, 8, 9]
        ↑  ↑
    [3, 5, 6, 7, 4, 1, 0, 2, 8, 9]
           ↑  ↑
    [3, 5, 6, 7, 4, 1, 0, 2, 8, 9]
              ↑  ↑
    [3, 5, 6, 4, 7, 1, 0, 2, 8, 9]
                 ↑  ↑
    [3, 5, 6, 4, 1, 7, 0, 2, 8, 9]
                    ↑  ↑
    [3, 5, 6, 4, 1, 0, 7, 2, 8, 9]
                       ↑  ↑
    [3, 5, 6, 4, 1, 0, 2, 7, 8, 9]
                          ↑  ↑
    [3, 5, 6, 4, 1, 0, 2, 7, 8, 9]
                             ↑  ↑

Четвёртый проход:

    [3, 5, 6, 4, 1, 0, 2, 7, 8, 9]
     ↑  ↑
    [3, 5, 6, 4, 1, 0, 2, 7, 8, 9]
        ↑  ↑
    [3, 5, 6, 4, 1, 0, 2, 7, 8, 9]
           ↑  ↑
    [3, 5, 4, 6, 1, 0, 2, 7, 8, 9]
              ↑  ↑
    [3, 5, 4, 1, 6, 0, 2, 7, 8, 9]
                 ↑  ↑
    [3, 5, 4, 1, 0, 6, 2, 7, 8, 9]
                    ↑  ↑
    [3, 5, 4, 1, 0, 2, 6, 7, 8, 9]
                       ↑  ↑
    [3, 5, 4, 1, 0, 2, 6, 7, 8, 9]
                          ↑  ↑
    [3, 5, 4, 1, 0, 2, 6, 7, 8, 9]
                             ↑  ↑

Пятый проход:

    [3, 5, 4, 1, 0, 2, 6, 7, 8, 9]
     ↑  ↑
    [3, 5, 4, 1, 0, 2, 6, 7, 8, 9]
        ↑  ↑
    [3, 4, 5, 1, 0, 2, 6, 7, 8, 9]
           ↑  ↑
    [3, 4, 1, 5, 0, 2, 6, 7, 8, 9]
              ↑  ↑
    [3, 4, 1, 0, 5, 2, 6, 7, 8, 9]
                 ↑  ↑
    [3, 4, 1, 0, 2, 5, 6, 7, 8, 9]
                    ↑  ↑
    [3, 4, 1, 0, 2, 5, 6, 7, 8, 9]
                       ↑  ↑
    [3, 4, 1, 0, 2, 5, 6, 7, 8, 9]
                          ↑  ↑
    [3, 4, 1, 0, 2, 5, 6, 7, 8, 9]
                             ↑  ↑

Шестой проход:

    [3, 4, 1, 0, 2, 5, 6, 7, 8, 9]
     ↑  ↑
    [3, 4, 1, 0, 2, 5, 6, 7, 8, 9]
        ↑  ↑
    [3, 1, 4, 0, 2, 5, 6, 7, 8, 9]
           ↑  ↑
    [3, 1, 0, 4, 2, 5, 6, 7, 8, 9]
              ↑  ↑
    [3, 1, 0, 2, 4, 5, 6, 7, 8, 9]
                 ↑  ↑
    [3, 1, 0, 2, 4, 5, 6, 7, 8, 9]
                    ↑  ↑
    [3, 1, 0, 2, 4, 5, 6, 7, 8, 9]
                       ↑  ↑
    [3, 1, 0, 2, 4, 5, 6, 7, 8, 9]
                          ↑  ↑
    [3, 1, 0, 2, 4, 5, 6, 7, 8, 9]
                             ↑  ↑

Седьмой проход:

    [3, 1, 0, 2, 4, 5, 6, 7, 8, 9]
     ↑  ↑
    [1, 3, 0, 2, 4, 5, 6, 7, 8, 9]
        ↑  ↑
    [1, 0, 3, 2, 4, 5, 6, 7, 8, 9]
           ↑  ↑
    [1, 0, 2, 3, 4, 5, 6, 7, 8, 9]
              ↑  ↑
    [1, 0, 2, 3, 4, 5, 6, 7, 8, 9]
                 ↑  ↑
    [1, 0, 2, 3, 4, 5, 6, 7, 8, 9]
                    ↑  ↑
    [1, 0, 2, 3, 4, 5, 6, 7, 8, 9]
                       ↑  ↑
    [1, 0, 2, 3, 4, 5, 6, 7, 8, 9]
                          ↑  ↑
    [1, 0, 2, 3, 4, 5, 6, 7, 8, 9]
                             ↑  ↑

Восьмой проход:

    [1, 0, 2, 3, 4, 5, 6, 7, 8, 9]
     ↑  ↑
    [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
        ↑  ↑
    . . .
    [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
                             ↑  ↑

Больше проходов не нужно.

Вопрос первый? Сколько нужно проходов алгоритму в худшем случае?

Число проходов равно `N−1`, где `N` — число элементов в списке. Каждый
проход ставит на `k−1`-е место `k`-й элемент по размеру. (Почему на `k−1`-е?
Потому что ячейки в списке в Python нумеруются с нуля). Т.е. первый
проход поставит на последнее (`N−1`) место самый большой элемент (`N`-й),
второй — на предпоследнее (`N−2`) место `N−1` по возрастанию и т.д.
Соответственно, `N−1`-й проход поставит на своё место 1-й элемент, и при
этом неизбежно на своём месте окажется 0-й элемент.

Таким образом, мы можем написать первую версию алгоритма:

```python
def bubble_sort(xs):
    N = len(xs)

    # перебираем все проходы
    for p in range(N-1):
        # перебираем все пары соседних элементов,
        # pos — номер первого элемента пары
        for pos in range(N-1):
            # меняем местами элементы, если порядок нарушен
            if xs[pos] > xs[pos + 1]:
                xs[pos], xs[pos + 1] = xs[pos + 1], xs[pos]
```

Можно ли рассмотренный алгоритм как-то ускорить?

Рассмотрим один из проходов алгоритма, например, шестой:

    [3, 4, 1, 0, 2, 5, 6, 7, 8, 9]
     ↑  ↑
    [3, 4, 1, 0, 2, 5, 6, 7, 8, 9]
        ↑  ↑
    [3, 1, 4, 0, 2, 5, 6, 7, 8, 9]
           ↑  ↑
    [3, 1, 0, 4, 2, 5, 6, 7, 8, 9]
              ↑  ↑
    [3, 1, 0, 2, 4, 5, 6, 7, 8, 9]
                 ↑  ↑
    [3, 1, 0, 2, 4, 5, 6, 7, 8, 9]
                    ↑  ↑
    [3, 1, 0, 2, 4, 5, 6, 7, 8, 9]
                       ↑  ↑
    [3, 1, 0, 2, 4, 5, 6, 7, 8, 9]
                          ↑  ↑
    [3, 1, 0, 2, 4, 5, 6, 7, 8, 9]
                             ↑  ↑

После того, как `4` встала на своё место, последующие шаги прохода стали
избыточными: последующие элементы уже отсортированы. Их даже просматривать
не надо. Таким образом, с каждым проходом можно верхнюю границу уменьшать
на единицу.

```python
def bubble_sort(xs):
    N = len(xs)
    upper = N-1

    for p in range(N-1):
        for pos in range(upper):
            if xs[pos] > xs[pos + 1]:
                xs[pos], xs[pos + 1] = xs[pos + 1], xs[pos]

        upper -= 1
```

В переменной `upper` находится верхняя граница просмотра списка на проходе.

На первом проходе мы теперь пробегаем по-прежнему все пары, на втором — все
пары, кроме последней, на третьем — все пары, кроме последней и предпоследней
и т.д.

Заметим, что после последнего прохода `upper` равна нулю. Поэтому вместо
счётчика проходов можно проверять условие `upper > 0`:

```python
def bubble_sort(xs):
    N = len(xs)
    upper = N-1

    while upper > 0:
        for pos in range(upper):
            if xs[pos] > xs[pos + 1]:
                xs[pos], xs[pos + 1] = xs[pos + 1], xs[pos]

        upper -= 1
```

Можем дальше ускорить этот алгорим. Что будет, если на входе у нас уже
отсортированный список? Алгоритм будет делать `N−1` проходов, в каждом проходе
будет просматривать часть списка. И всё будет в холостую, т.к. ни одного
обмена уже не будет.

Если на некотором проходе у нас не произошло ни одного обмена, значит
и на последующих проходах обмены происходить не будут. Если не было ни одного
обмена, значит, список уже отсортирован. Последующие проходы тоже в нём ничего
не поменяют.

Поэтому мы можем отслеживать факт наличия обмена и если обменов не было,
прерывать внешний цикл.

```python
def bubble_sort(xs):
    N = len(xs)
    upper = N-1

    unsorted = True
    while upper > 0 and unsorted:
        # гипотеза о том, что список уже был отсортирован
        unsorted = False
        for pos in range(upper):
            if xs[pos] > xs[pos + 1]:
                xs[pos], xs[pos + 1] = xs[pos + 1], xs[pos]
                # обмен произошёл, гипотезу опровергаем:
                unsorted = True

        upper -= 1
```
Переменная `unsorted` — признак того, что список, вероятно, не отсортирован.
Внутри внешнего цикла мы делаем гипотезу, что список отсортирован (присваиваем
`False`). Если не было ни одного обмена — гипотеза подтверждается, на входе
прохода список уже был отсортирован, повторять проходы не надо. Если хотя бы
один обмен был, значит список может быть не отсортирован.

Если у нас обменов не было, значит у нас уже был отсортированный список, больше
выполнять проходы не нужно (они ничего не дадут, хоть и не испортят). Если хотя бы
один обмен был, то мы не знаем, список отсортированный или нет.


Сортировка выбором
------------------

Сканируем весь список. Находим наибольший элемент и ставим его в конец. Сканируем
весь список, кроме последнего элемента, находим наибольший, ставим его предпоследним.
Сканируем весь список, кроме последних двух, находим наибольший, ставим его третьим
с конца. Повторяем, пока не расставим все элементы.

    [9, 3, 5, 8, 6, 7, 4, 1, 0, 2]
     ↑                           |
    [9, 3, 5, 8, 6, 7, 4, 1, 0, 2]
        ↑                        |
    [9, 3, 5, 8, 6, 7, 4, 1, 0, 2]
           ↑                     |
    [9, 3, 5, 8, 6, 7, 4, 1, 0, 2]
              ↑                  |
    [9, 3, 5, 8, 6, 7, 4, 1, 0, 2]
                 ↑               |
    [9, 3, 5, 8, 6, 7, 4, 1, 0, 2]
                    ↑            |
    [9, 3, 5, 8, 6, 7, 4, 1, 0, 2]
                       ↑         |
    [9, 3, 5, 8, 6, 7, 4, 1, 0, 2]
                          ↑      |
    [9, 3, 5, 8, 6, 7, 4, 1, 0, 2]
                             ↑   |
    [9, 3, 5, 8, 6, 7, 4, 1, 0, 2]
                                ↑|

Среди просмотренных наибольший — 9. Ставим его в конец (обмениваем местами
с последним).

    [2, 3, 5, 8, 6, 7, 4, 1, 0, 9]
     ↑                        |
    [2, 3, 5, 8, 6, 7, 4, 1, 0, 9]
        ↑                     |
    . . .
    [2, 3, 5, 8, 6, 7, 4, 1, 0, 9]
                             ↑|

Наибольший — 8, обмениваем его местами с предпоследним.

    [2, 3, 5, 0, 6, 7, 4, 1, 8, 9]
                           |

Повторяем дальше:

    [2, 3, 5, 0, 6, 1, 4, 7, 8, 9]
                           |
    [2, 3, 5, 0, 4, 1, 6, 7, 8, 9]
                        |
    [2, 3, 1, 0, 4, 5, 6, 7, 8, 9]
                     |
    [2, 3, 1, 0, 4, 5, 6, 7, 8, 9]
                  |
    [2, 0, 1, 3, 4, 5, 6, 7, 8, 9]
               |
    [1, 0, 2, 3, 4, 5, 6, 7, 8, 9]
            |
    [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
         |

Получили отсортированный список.









